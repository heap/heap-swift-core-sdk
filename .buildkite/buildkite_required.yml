# GENERATED BY TERRAFORM: /context/meta/terraform_modules/source_repo/
# DO NOT REMOVE/RENAME! EDIT CAUTIOUSLY!
#
# Build steps in this file DO block PR merges; they are "required". This is where
# you will want to put most of your build steps to protect your main branch and
# keep it green.
#
# FOR LARGE REPOS, limit the contents to triggering other pipelines that do the
# actual work, so that this stays a clear overview of build fan-out using an
# instance of the heap/monorepo-diff plugin as needed.
#
# FOR SMALL REPOS, this file can directly contain build-steps.

env:
  LC_ALL: "en_US.UTF-8"
  LANG: "en_US.UTF-8"

steps:

# Unit Tests

  - label: "iOS 12.4 - iPhone - Unit Test Suite"
    timeout_in_minutes: 5
    command:  "make clear_results iphone_ios12_unit_tests"
    agents:
      queue: "macos"
    artifact_paths:
      - "build/reports/*"

  - label: "iOS 16.0 - iPhone - Unit Test Suite"
    timeout_in_minutes: 5
    command:  "make clear_results iphone_ios16_unit_tests"
    agents:
      queue: "macos"
    artifact_paths:
      - "build/reports/*"

  - label: "iPadOS 12.4 - iPad - Unit Test Suite"
    timeout_in_minutes: 5
    command:  "make clear_results ipad_unit_tests"
    agents:
      queue: "macos"
    artifact_paths:
      - "build/reports/*"

  - label: "watchOS 9.0 - Apple Watch - Unit Test Suite"
    timeout_in_minutes: 5
    command:  "make clear_results watchos_unit_tests"
    agents:
      queue: "macos"
    artifact_paths:
      - "build/reports/*"

  - label: "tvOS 12.4 - Apple TV - Unit Test Suite"
    timeout_in_minutes: 5
    command:  "make clear_results tvos_unit_tests"
    agents:
      queue: "macos"
    artifact_paths:
      - "build/reports/*"

  - label: "macOS (current) - macOS - Unit Test Suite"
    timeout_in_minutes: 5
    command:  "make clear_results macos_unit_tests"
    agents:
      queue: "macos"
    artifact_paths:
      - "build/reports/*"

  - label: "macOS (current) - Catalyst - Unit Test Suite"
    timeout_in_minutes: 5
    command:  "make clear_results catalyst_unit_tests"
    agents:
      queue: "macos"
    artifact_paths:
      - "build/reports/*"

# Sample projects

  - label: "macOS - Build Sample App"
    timeout_in_minutes: 5
    command:  "make macos_sample_app"
    agents:
      queue: "macos"

  - label: "iOS - Build Sample App"
    timeout_in_minutes: 5
    command:  "make ios_sample_app"
    agents:
      queue: "macos"

  - label: "iOS - Build Sample Extension"
    timeout_in_minutes: 5
    command:  "make ios_sample_extension"
    agents:
      queue: "macos"

# Test reporting

  - wait: ~
    continue_on_failure: true
  - label: "Annotate build with test errors"
    plugins:
      - heap/junit-annotate#v1.9.0:
          artifacts: build/reports/*.xml
